import json
import re
import sys
import io

# Fix Windows console encoding
if sys.platform == 'win32':
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

# موسوعة كبيرة للكلمات المفتاحية العربية - نسخة محسّنة

def expand_english_keywords(name_en, existing_keywords):
    """توسيع الكلمات الإنجليزية"""
    new_keywords = list(set(existing_keywords.copy() if existing_keywords else []))

    if name_en not in new_keywords:
        new_keywords.append(name_en)

    name_lower = name_en.lower()

    # توسيعات شاملة
    expansions = {
        'tire': ['tires', 'tyres', 'tyre', 'wheel', 'wheels', 'automotive tires', 'car tires',
                 'tire shop', 'tire store', 'tire center', 'tire service', 'tire dealer',
                 'tire fitting', 'tire sales', 'tire repair', 'tire replacement'],
        'auto': ['automotive', 'automobile', 'car', 'vehicle', 'auto parts', 'auto service',
                 'auto repair', 'auto shop', 'auto accessories', 'car accessories'],
        'accessories': ['accessory', 'parts', 'supplies', 'equipment', 'add-ons', 'extras'],
        'store': ['shop', 'retail', 'outlet', 'mart', 'market', 'vendor', 'retailer', 'merchant'],
        'restaurant': ['dining', 'eatery', 'cafe', 'bistro', 'food', 'cuisine', 'diner'],
        'pharmacy': ['drugstore', 'chemist', 'apothecary', 'medicine', 'drug store', 'medical'],
        'coffee': ['cafe', 'coffee shop', 'coffee house', 'coffee bar', 'espresso', 'cafeteria'],
        'car': ['automobile', 'auto', 'vehicle', 'motor', 'automotive'],
        'repair': ['fix', 'service', 'maintenance', 'workshop', 'garage'],
        'laundry': ['laundromat', 'dry clean', 'washing', 'cleaners', 'dry cleaning'],
    }

    for key, terms in expansions.items():
        if key in name_lower:
            new_keywords.extend([t for t in terms if t not in new_keywords])

    return list(set(new_keywords))[:30]


def expand_arabic_keywords(name_ar, existing_keywords):
    """توسيع الكلمات العربية - موسوعة شاملة"""
    new_keywords = list(set(existing_keywords.copy() if existing_keywords else []))

    if name_ar not in new_keywords:
        new_keywords.append(name_ar)

    # موسوعة كبيرة وشاملة للكلمات المفتاحية - محدّثة
    mega_dictionary = {
        # ============================================
        # المأكولات والمشروبات - Food and Beverages
        # ============================================

        # المخابز والمعجنات - Bakeries and Pastries
        'مخبز': ['مخابز', 'خبز', 'فرن', 'أفران', 'مخبزة', 'خباز', 'bakery', 'bread',
                 'فطائر', 'معجنات', 'صمون', 'خبز طازج', 'خبز يومي', 'مخبز آلي'],

        'معجنات': ['معجن', 'فطائر', 'فطيرة', 'كرواسون', 'كروسان', 'دانش', 'باتيه',
                   'سمبوسة', 'سمبوسك', 'باف باستري', 'بف', 'pastries', 'pastry',
                   'عجين', 'عجينة', 'لفائف', 'رول', 'كعك محشي', 'فطاير', 'فطير',
                   'بليلة', 'بلح الشام', 'زلابية', 'زنود الست', 'عش البلبل',
                   'كنافة نابلسية', 'معمول', 'كليجة', 'كليجا', 'غريبة'],

        'بليلة': ['بلح الشام', 'زنود الست', 'عش البلبل', 'لقمة القاضي', 'عوامة',
                  'معجنات شرقية', 'معجنات حلوة', 'حلويات معجنات', 'معجنات بالقطر'],

        'خبز': ['مخبز', 'عيش', 'رغيف', 'أرغفة', 'صمون', 'bread', 'toast', 'خبز طازج',
                'خبز تنور', 'خبز عربي', 'خبز إفرنجي', 'خبز فرنسي', 'باغيت', 'توست',
                'صامولي', 'خبز حمام', 'خبز تميس', 'خبز برجر', 'خبز هوت دوق'],

        'فطائر': ['فطيرة', 'معجنات', 'باتيه', 'سمبوسة', 'pie', 'pies', 'تارت',
                  'فطيرة تفاح', 'فطيرة لحم', 'فطائر الجبن', 'فطائر السبانخ',
                  'مناقيش', 'منقوشة', 'فطيرة زعتر', 'لحم بعجين'],

        'كرواسون': ['كروسان', 'croissant', 'كرواسانت', 'معجنات فرنسية',
                    'كرواسون شوكولاتة', 'كرواسون جبنة', 'كرواسون زعتر'],

        # الحلويات - Desserts and Sweets
        'حلويات': ['حلوى', 'حلو', 'سويت', 'sweets', 'dessert', 'deserts', 'حلا',
                   'حلويات شرقية', 'حلويات غربية', 'معمول', 'كعك', 'بسكويت',
                   'كيك', 'جاتو', 'تورتة', 'كنافة', 'بقلاوة', 'بسبوسة', 'هريسة',
                   'قطايف', 'لقمة القاضي', 'عوامة', 'غريبة', 'شوكولاتة'],

        'كيك': ['كعك', 'كعكة', 'جاتو', 'تورتة', 'cake', 'كب كيك', 'cupcake',
                'كيك عيد ميلاد', 'تشيز كيك', 'براونيز', 'ريد فيلفت', 'كيك شوكولاتة'],

        'كوكيز': ['بسكويت', 'كوكي', 'cookies', 'cookie', 'بسكوت', 'بيسكوت',
                  'كوكيز شوكولاتة', 'كوكيز زبدة', 'أوريو', 'كوكيز محشي'],

        'شوكولاتة': ['شوكولا', 'شكلت', 'chocolate', 'كاكاو', 'شوكليت', 'تشوكليت',
                     'شوكولاتة داكنة', 'شوكولاتة بالحليب', 'شوكولاتة بيضاء',
                     'ترافل', 'براونيز', 'نوتيلا', 'فيريرو'],

        'آيس كريم': ['أيس كريم', 'ايس كريم', 'بوظة', 'جيلاتي', 'ice cream', 'gelato',
                     'مثلجات', 'دوندرمة', 'ايسكريم', 'مثلج', 'سوفت ايس كريم'],

        'كنافة': ['كنافه', 'كنفه', 'kunafa', 'kunafeh', 'كنافة نابلسية',
                  'كنافة بالقشطة', 'كنافة ناعمة', 'كنافة خشنة'],

        'بقلاوة': ['بقلاوه', 'باكلافا', 'baklava', 'بقلافة', 'بقلاوة فستق',
                   'بقلاوة جوز', 'بقلاوة بالعسل'],

        # المطاعم - Restaurants
        'مطعم': ['مطاعم', 'ريستورانت', 'restaurant', 'مأكولات', 'طعام', 'أكل',
                 'وجبات', 'طبخ', 'مطبخ', 'كافتيريا', 'بوفيه', 'فود', 'food',
                 'دايننق', 'dining', 'مطعم شعبي', 'مطعم فاخر'],

        'مطبخ': ['طبخ', 'أكل', 'مأكولات', 'طعام', 'kitchen', 'cuisine',
                 'مطبخ عربي', 'مطبخ هندي', 'مطبخ صيني', 'مطبخ إيطالي',
                 'مطبخ تركي', 'مطبخ لبناني', 'مطبخ مصري', 'مطبخ سوري'],

        'بيتزا': ['بيتزا', 'بيزا', 'pizza', 'فطائر', 'بيتزا إيطالية',
                  'بيتزا مارغريتا', 'بيتزا بيبروني', 'بيتزا باللحم', 'بيتزا بالجبن'],

        'برجر': ['برغر', 'برقر', 'همبرجر', 'burger', 'hamburger', 'ساندويتش',
                 'برجر لحم', 'برجر دجاج', 'تشيز برجر', 'دبل برجر'],

        'وجبات سريعة': ['فاست فود', 'fast food', 'برجر', 'بيتزا', 'ساندويتش',
                         'شاورما', 'فلافل', 'تاكو', 'هوت دوق', 'تشيكن', 'دجاج مقلي',
                         'بطاطس مقلية', 'بندر بطاط', 'بطاطا', 'فرايز'],

        'بطاطس': ['بطاطا', 'بطاط', 'بطاطس مقلية', 'فرايز', 'fries', 'french fries',
                  'بندر بطاط', 'بطاطس ودجز', 'wedges', 'بطاطس محمرة', 'بطاطس مقرمشة',
                  'potato', 'potatoes', 'بطاطس بالجبن', 'تشيز فرايز'],

        'شاورما': ['شاورما', 'شاورمة', 'shawarma', 'دونر', 'دونر كباب', 'كباب تركي',
                   'شاورما لحم', 'شاورما دجاج', 'شاورما عربية'],

        'فلافل': ['فلافل', 'طعمية', 'falafel', 'فول مقلي', 'فلافل صامولي',
                  'فلافل خضار'],

        'كباب': ['شيش كباب', 'كباب حلة', 'kebab', 'كفتة', 'مشاوي',
                 'كباب عراقي', 'كباب لبناني', 'كباب تركي', 'كباب هندي'],

        'مشاوي': ['شواء', 'مشوي', 'grilled', 'bbq', 'باربكيو', 'كباب', 'تكا',
                  'دجاج مشوي', 'لحم مشوي', 'فحم', 'شواية', 'منقل'],

        # المقاهي والمشروبات - Cafes and Beverages
        'مقهى': ['مقاهي', 'كافيه', 'كافيه', 'كوفي', 'قهوة', 'كافي', 'كافيتريا',
                 'coffee', 'cafe', 'كافي شوب', 'coffee shop', 'قهوه'],

        'كافيه': ['كافيه', 'مقهى', 'كوفي', 'قهوة', 'كافي', 'coffee', 'café',
                  'كافي شوب', 'كافيتريا'],

        'قهوة': ['قهوه', 'كوفي', 'coffee', 'كافي', 'كافيه', 'اسبريسو', 'espresso',
                 'كابتشينو', 'cappuccino', 'لاتيه', 'latte', 'أمريكانو', 'americano',
                 'موكا', 'mocha', 'ماكياتو', 'macchiato', 'قهوة عربية', 'قهوة تركية'],

        'شاي': ['تي', 'tea', 'شاي أحمر', 'شاي أخضر', 'شاي أسود', 'شاي بالحليب',
                'شاي كرك', 'شاي نعناع', 'شاي زهورات', 'ليبتون'],

        'عصير': ['عصائر', 'juice', 'جوس', 'عصير طبيعي', 'عصير طازج', 'سموذي',
                 'smoothie', 'كوكتيل', 'مشروبات طبيعية', 'فريش'],

        'مشروبات': ['مشروب', 'عصير', 'قهوة', 'شاي', 'beverages', 'drinks',
                    'كوكاكولا', 'بيبسي', 'ميراندا', 'سفن اب', 'سبرايت'],

        # المأكولات البحرية - Seafood
        'مأكولات بحرية': ['سي فود', 'seafood', 'سمك', 'أسماك', 'جمبري', 'روبيان',
                           'قريدس', 'كابوريا', 'سلطعون', 'كركند', 'لوبستر', 'محار',
                           'كاليماري', 'سبيط', 'أخطبوط'],

        'سمك': ['أسماك', 'fish', 'سمكة', 'مسمط', 'مقلي سمك', 'سمك مشوي',
                'فيليه سمك', 'سمك مشوي', 'سمك قشر', 'سلمون', 'تونة', 'هامور'],

        'روبيان': ['جمبري', 'قريدس', 'shrimp', 'prawns', 'روبيان مقلي',
                   'روبيان مشوي', 'جمبري فرايد'],

        # الوجبات الآسيوية - Asian Food
        'سوشي': ['سوشي', 'sushi', 'ساشيمي', 'sashimi', 'ماكي', 'maki', 'نيجيري',
                 'نيجري', 'رول', 'rolls', 'سوشي سلمون', 'سوشي تونة'],

        'صيني': ['طعام صيني', 'chinese food', 'نودلز', 'noodles', 'دايم سم',
                 'دجاج كونغ باو', 'أرز مقلي', 'معكرونة صينية', 'رامن'],

        'هندي': ['طعام هندي', 'indian food', 'كاري', 'curry', 'تندوري', 'tandoori',
                 'بيرياني', 'biryani', 'مسالا', 'masala', 'نان', 'nan'],

        # الوجبات العربية - Arabic Food
        'مندي': ['مندي', 'mandi', 'أرز مندي', 'مندي لحم', 'مندي دجاج', 'زربيان'],

        'كبسة': ['كبسه', 'kabsa', 'مكبوس', 'أرز كبسة', 'كبسة لحم', 'كبسة دجاج'],

        'مظبي': ['مظبي', 'مضبي', 'مظبي لحم', 'مظبي دجاج', 'أرز مظبي'],

        'منتو': ['منتو', 'مانتو', 'manto', 'معجنات أفغانية', 'معجنات آسيوية',
                'ديم سم', 'دمبلينج', 'dumpling', 'مطبخ أفغاني', 'أكلات أفغانية'],

        'يغمش': ['يغمش', 'يغماش', 'yaghmash', 'مطبخ تركي', 'مطبخ كردي',
                'أكل تركي', 'أكل كردي', 'طعام تركي', 'معجنات تركية'],

        # ============================================
        # السيارات والنقل - Automotive
        # ============================================

        'إطارات': ['إطار', 'كفرات', 'كفر', 'عجلات', 'عجل', 'تواير', 'دواليب', 'جنوط',
                   'إطارات سيارات', 'كفرات سيارات', 'بيع إطارات', 'محل إطارات',
                   'مركز إطارات', 'تركيب إطارات', 'تبديل إطارات', 'صيانة إطارات',
                   'إطارات جديدة', 'إطارات مستعملة', 'تاير', 'تايرات', 'tire', 'tires'],

        'كفرات': ['كفر', 'إطارات', 'إطار', 'عجلات', 'تواير', 'دواليب', 'جنوط',
                  'كفرات سيارات', 'بيع كفرات', 'محل كفرات', 'كفرات جديدة'],

        'تواير': ['إطارات', 'كفرات', 'عجلات', 'دواليب', 'تاير'],

        'سيارات': ['سياره', 'عربية', 'عربيات', 'مركبة', 'مركبات', 'أوتو', 'كار',
                   'عربيه', 'سيارة', 'مرسيدس', 'تويوتا', 'هوندا', 'نيسان'],

        'زينة': ['زينه', 'إكسسوارات', 'اكسسوارات', 'تزيين', 'ديكور', 'تجميل',
                 'زخرفة', 'زينة سيارات', 'اكسسوار'],

        'إكسسوارات': ['اكسسوارات', 'زينة', 'ملحقات', 'قطع', 'أدوات', 'معدات',
                      'كماليات', 'اضافات', 'تجهيزات', 'ديكورات'],

        # ============================================
        # الصيدليات والصحة - Pharmacies and Health
        # ============================================

        'صيدلية': ['صيدليه', 'صيدليات', 'دواء', 'أدوية', 'ادويه', 'علاج', 'pharmacy',
                   'طب', 'دوا', 'ادوية', 'صيدله', 'الصيدلية'],

        'عيادة': ['عيادات', 'كلينيك', 'مركز طبي', 'clinic', 'طبي', 'علاج',
                  'دكتور', 'طبيب', 'معالجة'],

        'مستشفى': ['مستشفيات', 'hospital', 'مستوصف', 'مركز صحي', 'صحة'],

        # ============================================
        # المحلات والتسوق - Stores and Shopping
        # ============================================

        'متجر': ['محل', 'دكان', 'مول', 'سوق', 'بيع', 'تسوق', 'شراء', 'shop', 'store',
                 'متاجر', 'محلات', 'مركز تسوق'],

        'محل': ['متجر', 'دكان', 'مول', 'حانوت', 'بقالة', 'سوبر ماركت'],

        'سوبر': ['سوبر ماركت', 'بقالة', 'هايبر', 'ماركت', 'تموينات', 'مواد غذائية'],

        # ============================================
        # الخدمات - Services
        # ============================================

        'مغسلة': ['مغاسل', 'غسيل', 'تنظيف', 'laundry', 'غساله', 'مغسله', 'تنظيف ملابس',
                  'كوي', 'تنظيف جاف', 'دراي كلين'],

        'صالون': ['صالونات', 'حلاقة', 'تجميل', 'salon', 'حلاق', 'كوافير', 'سشوار',
                  'صالون حلاقة', 'صالون تجميل', 'صالون نسائي'],

        'حلاق': ['حلاقة', 'صالون', 'barber', 'كوافير', 'حلاقه'],

        # ============================================
        # الإلكترونيات - Electronics
        # ============================================

        'إلكترونيات': ['الكترونيات', 'الكترونية', 'أجهزة', 'electronics', 'تقنية',
                       'تكنولوجيا', 'موبايل', 'جوال', 'لابتوب', 'كمبيوتر'],

        'موبايل': ['جوال', 'هاتف', 'mobile', 'phone', 'تليفون', 'آيفون', 'سامسونج'],

        'كمبيوتر': ['حاسوب', 'لابتوب', 'computer', 'pc', 'حاسب', 'كومبيوتر'],

        # ============================================
        # الملابس - Clothing
        # ============================================

        'ملابس': ['البسة', 'كسوة', 'ثياب', 'clothes', 'أزياء', 'موضة', 'فساتين',
                  'بدل', 'قمصان', 'بناطيل'],

        'أزياء': ['موضة', 'ملابس', 'fashion', 'ثياب', 'البسة'],

        # ============================================
        # الذهب والمجوهرات - Gold and Jewelry
        # ============================================

        'ذهب': ['ذهبية', 'مجوهرات', 'gold', 'فضة', 'حلي', 'مشغولات'],

        'مجوهرات': ['ذهب', 'فضة', 'jewelry', 'حلي', 'اكسسوارات', 'زينة'],

        # ============================================
        # الورود والزهور - Flowers
        # ============================================

        'ورود': ['ورد', 'زهور', 'flowers', 'باقات', 'نباتات', 'أزهار', 'فلاور'],

        'زهور': ['ورود', 'ورد', 'flowers', 'باقات', 'زهره', 'زهرة'],

        # ============================================
        # البناء والتشييد - Construction
        # ============================================

        'مواد': ['مواد بناء', 'بناء', 'تشييد', 'إنشاءات', 'building materials'],

        'بناء': ['إنشاءات', 'تشييد', 'مقاولات', 'عمار', 'building'],

        # ============================================
        # الأثاث - Furniture
        # ============================================

        'أثاث': ['موبيليا', 'عفش', 'furniture', 'ديكور', 'منزل', 'اثاث'],

        'موبيليا': ['أثاث', 'عفش', 'furniture', 'اثاث منزلي'],

        'موكيت': ['موكيت', 'سجاد', 'سجادة', 'carpet', 'rug', 'مفروشات',
                  'موكيت أرضي', 'سجاد شرقي', 'سجاد تركي', 'سجاد فارسي',
                  'موكيت منزلي', 'موكيت مكتبي', 'بساط', 'مشمع', 'أرضيات'],

        'سجاد': ['سجادة', 'موكيت', 'carpet', 'rug', 'مفروشات', 'بساط',
                'سجاد شرقي', 'سجاد عجمي', 'سجاد يدوي', 'سجاد حرير'],

        # ============================================
        # الرياضة - Sports
        # ============================================

        'رياضة': ['رياضية', 'نادي', 'جيم', 'gym', 'fitness', 'لياقة', 'تمارين'],

        'جيم': ['نادي رياضي', 'رياضة', 'gym', 'fitness', 'لياقة'],

        # ============================================
        # الكتب - Books
        # ============================================

        'مكتبة': ['كتب', 'قراءة', 'library', 'bookstore', 'كتاب', 'مكتبه'],

        'كتب': ['كتاب', 'قراءة', 'books', 'مكتبة', 'library'],

        # ============================================
        # أخرى - Others
        # ============================================

        'تصليح': ['إصلاح', 'صيانة', 'repair', 'تصليحات', 'ورشة'],

        'ورشة': ['تصليح', 'صيانة', 'إصلاح', 'workshop', 'garage'],

        'خدمات': ['خدمة', 'services', 'service', 'خدمه'],

        'مركز': ['مراكز', 'center', 'centre', 'صالة'],

        'شركة': ['شركات', 'company', 'مؤسسة', 'مؤسسات'],
    }

    # البحث في الموسوعة
    for key, terms in mega_dictionary.items():
        if key in name_ar:
            for term in terms:
                if term not in new_keywords:
                    new_keywords.append(term)

    # إضافة كلمات من الاسم نفسه
    words = re.split(r'[\s،,]+', name_ar)
    for word in words:
        if len(word) > 2 and word not in ['في', 'من', 'إلى', 'على', 'عن']:
            if word not in new_keywords:
                new_keywords.append(word)

            # البحث عن مطابقات جزئية
            for key in mega_dictionary.keys():
                if key in word or word in key:
                    new_keywords.extend([t for t in mega_dictionary[key] if t not in new_keywords])

    return list(set(new_keywords))[:50]  # زيادة الحد الأقصى


def expand_all_categories(input_file, output_file):
    """توسيع الكلمات المفتاحية لجميع التصنيفات"""

    print("�� قراءة الملف...")
    with open(input_file, 'r', encoding='utf-8') as f:
        data = json.load(f)

    print(f"✅ تم تحميل {len(data)} تصنيف\n")

    total_ar_before = 0
    total_en_before = 0

    for category in data:
        total_ar_before += len(category.get('search_key_words_ar', []) or [])
        total_en_before += len(category.get('search_key_words_en', []) or [])

    print(f"📊 الإحصائيات قبل التوسيع:")
    print(f"   - كلمات عربية: {total_ar_before}")
    print(f"   - كلمات إنجليزية: {total_en_before}\n")

    print("🚀 بدء التوسيع...")

    for i, category in enumerate(data):
        if i % 100 == 0:
            print(f"   معالجة {i}/{len(data)}...")

        # توسيع الكلمات العربية
        if 'name_ar' in category:
            category['search_key_words_ar'] = expand_arabic_keywords(
                category['name_ar'],
                category.get('search_key_words_ar')
            )

        # توسيع الكلمات الإنجليزية
        if 'name_en' in category:
            category['search_key_words_en'] = expand_english_keywords(
                category['name_en'],
                category.get('search_key_words_en')
            )

    total_ar_after = 0
    total_en_after = 0

    for category in data:
        total_ar_after += len(category.get('search_key_words_ar', []) or [])
        total_en_after += len(category.get('search_key_words_en', []) or [])

    print(f"\n📊 الإحصائيات بعد التوسيع:")
    print(f"   - كلمات عربية: {total_ar_after} (+{total_ar_after - total_ar_before})")
    print(f"   - كلمات إنجليزية: {total_en_after} (+{total_en_after - total_en_before})")

    print(f"\n💾 حفظ الملف...")
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"✅ تم! حُفظ في: {output_file}\n")

    # عرض عينات
    print("📋 عينات من النتائج:\n")
    for i in [0, 100, 200, 300, 400]:
        if i < len(data):
            cat = data[i]
            print(f"   {cat['name_ar']} ({cat['name_en']})")
            print(f"   - عربي ({len(cat.get('search_key_words_ar', []))}): {', '.join(cat.get('search_key_words_ar', [])[:5])}...")
            print(f"   - إنجليزي ({len(cat.get('search_key_words_en', []))}): {', '.join(cat.get('search_key_words_en', [])[:5])}...")
            print()


if __name__ == '__main__':
    input_file = r'f:\category and subcategory\wash-tasnifoh\data\categories.json'
    output_file = r'f:\category and subcategory\wash-tasnifoh\data\categories_expanded.json'

    expand_all_categories(input_file, output_file)

    print("=" * 70)
    print("🎉 اكتمل توسيع الموسوعة بنجاح!")
    print("=" * 70)
